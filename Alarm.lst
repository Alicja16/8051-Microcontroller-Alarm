     1                  ;TIMER 0
     2        0000      T0_G EQU 0 ;GATE
     3        0000      T0_C EQU 0 ;COUNTER/-TIMER
     4        0001      T0_M EQU 1 ;MODE (0..3)
     5        0001      TIM0 EQU T0_M+T0_C*4+T0_G*8
     6                  
     7                  ;TIMER 1
     8        0000      T1_G EQU 0 ;GATE
     9        0000      T1_C EQU 0 ;COUNTER/-TIMER
    10        0000      T1_M EQU 0 ;MODE (0..3)
    11        0000      TIM1 EQU T1_M+T1_C*4+T1_G*8
    12                  
    13        0001      TMOD_SET EQU TIM0+TIM1*16
    14                  
    15                  ;50[ms] = 50 000[Å S]*(11.0592[MHz]/12) = 46 080 cykli = 180 * 256
    16                  
    17        004C      TH0_SET EQU 256-180
    18        0000      TL0_SET EQU 0
    19                  
    20        0030      TIME EQU 30H
    21                  
    22  0000: 02 01 00      LJMP START
    23                  ;-----------------------------------------------
    24  000B:               ORG 000BH
    25  000B:           T0_ISR:
    26  000B: 75 8C 4C      MOV  TH0, #TH0_SET
    27  000E: 75 8A 00      MOV  TL0, #TL0_SET
    28  0011: D5 30 09      DJNZ TIME, NO_1SEC
    29  0014: 75 30 14      MOV  TIME, #20
    30  0017: 12 01 AF      LCALL CLOCK_CHANGE
    31  001A: 12 01 D4      LCALL WRITE_CLOCK
    32  001D:           NO_1SEC:
    33  001D: 32            RETI
    34                  ;-----------------------------------------------
    35  0100:           	ORG 100H
    36                      
    37  0100:           START:
    38  0100: 75 81 30      MOV SP, #30h
    39  0103: 75 89 01      MOV TMOD,#TMOD_SET ;Timer 0 liczy czas
    40  0106: 75 30 14      MOV TIME, #20
    41  0109: D2 AF         SETB EA
    42                  
    43  010B: 12 81 0C      LCALL LCD_CLR
    44  010E: 12 01 29      LCALL ENTER_START_TIME
    45                      ;hh:mm:ss
    46                      ;R1:R2:R3
    47  0111:           WAIT_ENT:
    48  0111: 12 81 1C      LCALL WAIT_KEY
    49  0114: B4 0E FA      CJNE A, #14, WAIT_ENT
    50  0117: 75 8C 4C      MOV TH0,#TH0_SET
    51  011A: 75 8A 00      MOV TL0,#TL0_SET
    52  011D: 75 30 14      MOV TIME,#20
    53  0120: D2 A9         SETB ET0
    54  0122: D2 8C         SETB TR0 
    55                  
    56  0124:           MAIN_LOOP:
    57  0124: 80 FE         SJMP MAIN_LOOP
    58                  
    59  0126:           STOP:
    60  0126: 80 FE     	SJMP $
    61  0128: 00        	NOP
    62                  
    63                  ;-------------------FUNKCJE----------------------
    64  0129:           ENTER_START_TIME:
    65  0129: 74 48         MOV A,#'H'
    66  012B: 12 81 02      LCALL WRITE_DATA
    67  012E: 74 48         MOV A,#'H'
    68  0130: 12 81 02      LCALL WRITE_DATA
    69  0133: 74 3A         MOV A,#':'
    70  0135: 12 81 02      LCALL WRITE_DATA
    71  0138: 74 4D         MOV A,#'M'
    72  013A: 12 81 02      LCALL WRITE_DATA
    73  013D: 74 4D         MOV A,#'M'
    74  013F: 12 81 02      LCALL WRITE_DATA
    75  0142: 74 3A         MOV A,#':'
    76  0144: 12 81 02      LCALL WRITE_DATA
    77  0147: 74 53         MOV A,#'S'
    78  0149: 12 81 02      LCALL WRITE_DATA
    79  014C: 74 53         MOV A,#'S'
    80  014E: 12 81 02      LCALL WRITE_DATA
    81  0151: 7E 00         MOV R6,#0
    82  0153:           LOOP:
    83  0153: 74 20         MOV A,#' '
    84  0155: 12 81 02      LCALL WRITE_DATA
    85  0158: 0E            INC R6
    86  0159: BE 08 F7      CJNE R6,#08, LOOP
    87                  
    88  015C: 12 81 1C      LCALL WAIT_KEY
    89  015F: C0 E0         PUSH ACC
    90  0161: 12 81 1C      LCALL WAIT_KEY
    91  0164: C0 E0         PUSH ACC
    92  0166: 12 01 9A      LCALL BCD
    93  0169: F9            MOV R1,A
    94  016A: 12 81 04      LCALL WRITE_HEX
    95                  
    96  016D: 74 3A         MOV A,#':'
    97  016F: 12 81 02      LCALL WRITE_DATA
    98                      
    99  0172: 12 81 1C      LCALL WAIT_KEY
   100  0175: C0 E0         PUSH ACC
   101  0177: 12 81 1C      LCALL WAIT_KEY
   102  017A: C0 E0         PUSH ACC
   103  017C: 12 01 9A      LCALL BCD
   104  017F: FA            MOV R2,A
   105  0180: 12 81 04      LCALL WRITE_HEX
   106                  
   107  0183: 74 3A         MOV A,#':'
   108  0185: 12 81 02      LCALL WRITE_DATA
   109                      
   110  0188: 12 81 1C      LCALL WAIT_KEY
   111  018B: C0 E0         PUSH ACC
   112  018D: 12 81 1C      LCALL WAIT_KEY
   113  0190: C0 E0         PUSH ACC
   114  0192: 12 01 9A      LCALL BCD
   115  0195: FB            MOV R3,A
   116  0196: 12 81 04      LCALL WRITE_HEX
   117  0199: 22            RET
   118                  ;-----------------------------------------------
   119  019A:           BCD:
   120  019A: D0 06         POP 06H
   121  019C: D0 07         POP 07H
   122  019E: D0 F0         POP B ; B=J
   123  01A0: D0 E0         POP ACC ; A=T
   124  01A2: 54 0F         ANL A, #0FH
   125  01A4: C4            SWAP A ; TT00
   126  01A5: 53 F0 0F      ANL B, #0FH 
   127  01A8: 45 F0         ORL A,B ; A=TTJJ
   128  01AA: C0 07         PUSH 07H
   129  01AC: C0 06         PUSH 06H
   130  01AE: 22            RET
   131                  ;-----------------------------------------------
   132  01AF:           CLOCK_CHANGE:
   133  01AF: 78 03         MOV R0,#03
   134  01B1: BB 59 11      CJNE R3,#01011001B, INC_H_M_S
   135  01B4: 7B 00         MOV R3,#00 ; R3 = 00
   136  01B6: 78 02         MOV R0,#02
   137  01B8: BA 59 0A      CJNE R2,#01011001B, INC_H_M_S
   138  01BB: 7A 00         MOV R2,#00 ; R2 = 00
   139  01BD: 78 01         MOV R0,#01
   140  01BF: B9 23 03      CJNE R1,#00100011B, INC_H_M_S
   141  01C2: 79 00         MOV R1,#00
   142  01C4: 22            RET
   143                  ;-----------------------------------------------
   144  01C5:           INC_H_M_S:
   145  01C5: E6            MOV A, @R0
   146  01C6: 54 0F         ANL A, #0FH
   147  01C8: B4 09 07      CJNE A, #09, ADD_ONE
   148  01CB: E6            MOV A, @R0
   149  01CC: 54 F0         ANL A, #0F0H
   150  01CE: 24 10         ADD A, #10H
   151  01D0: F6            MOV @R0, A
   152  01D1: 22            RET
   153  01D2:           ADD_ONE:
   154  01D2: 06            INC @R0
   155  01D3: 22            RET
   156                  ;-----------------------------------------------
   157  01D4:           WRITE_CLOCK:
   158  01D4: 12 81 0C      LCALL LCD_CLR
   159  01D7: E9            MOV A,R1
   160  01D8: 12 81 04      LCALL WRITE_HEX
   161  01DB: 74 3A         MOV A,#':'
   162  01DD: 12 81 02      LCALL WRITE_DATA
   163  01E0: EA            MOV A,R2
   164  01E1: 12 81 04      LCALL WRITE_HEX
   165  01E4: 74 3A         MOV A,#':'
   166  01E6: 12 81 02      LCALL WRITE_DATA
   167  01E9: EB            MOV A,R3
   168  01EA: 12 81 04      LCALL WRITE_HEX
   169  01ED: 22            RET
